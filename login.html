<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Shopezz â€” Connexion</title>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: #f6f7fb;
      --card: #ffffff;
      --primary: #0b74ff;
      --muted: #6b7280;
      --danger: #ef4444;
      --success: #10b981;
      --radius: 12px;
    }
    *{box-sizing:border-box;font-family:'Poppins',sans-serif}
    body{margin:0;background:linear-gradient(180deg,var(--bg),#fff);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px;color:#111}
    .container{width:100%;max-width:900px;display:grid;grid-template-columns:1fr 400px;gap:28px;align-items:center}
    .hero{padding:36px;border-radius:var(--radius);background:linear-gradient(180deg,#fff,#f9fbff);box-shadow:0 6px 30px rgba(11,116,255,0.06);}
    .hero h1{margin:0;font-size:28px}
    .hero p{color:var(--muted)}
    .card{background:var(--card);border-radius:var(--radius);box-shadow:0 6px 24px rgba(15,23,42,0.06);padding:30px;}
    form{display:flex;flex-direction:column;gap:16px}
    label{font-size:13px;color:#333}
    input[type="email"],input[type="password"]{
      padding:12px 14px;border-radius:10px;border:1px solid #e6e9ef;font-size:14px;outline:none;
    }
    input:focus{box-shadow:0 0 0 4px rgba(11,116,255,0.06);border-color:var(--primary)}
    .btn{background:var(--primary);color:#fff;padding:12px;border:none;border-radius:10px;font-weight:600;cursor:pointer}
    .muted{color:var(--muted);font-size:13px}
    .link{color:var(--primary);text-decoration:none;font-weight:600}
    .message{padding:10px;border-radius:8px;font-size:14px}
    .error{background:rgba(239,68,68,0.08);color:var(--danger);border:1px solid rgba(239,68,68,0.12)}
    .success{background:rgba(16,185,129,0.08);color:var(--success);border:1px solid rgba(16,185,129,0.12)}
    @media(max-width:880px){.container{grid-template-columns:1fr;max-width:480px}}
  </style>
</head>
<body>
  <main class="container">
    <section class="hero">
      <h1>Heureux de te revoir ðŸ‘‹</h1>
      <p>Connecte-toi Ã  ton compte Shopezz pour consulter ton historique dâ€™achats, suivre tes commandes et profiter de toutes nos offres exclusives.</p>
    </section>

    <aside class="card" aria-labelledby="login-title">
      <h2 id="login-title" style="margin-top:0">Connexion</h2>
      <div id="msg" aria-live="polite"></div>

      <form id="loginForm" novalidate>
        <div>
          <label for="email">Adresse email</label>
          <input id="email" type="email" placeholder="ex@exemple.com" required />
        </div>

        <div>
          <label for="password">Mot de passe</label>
          <input id="password" type="password" placeholder="Votre mot de passe" required />
        </div>

        <button type="submit" class="btn">Se connecter</button>

        <div class="muted">
          Pas encore de compte ? <a href="register.html" class="link">CrÃ©er un compte</a>
        </div>
      </form>
    </aside>
  </main>

  <script>
    // Utilitaires
    function showMessage(text, type='error'){
      const msg=document.getElementById('msg');
      msg.innerHTML='<div class="message '+(type==='success'?'success':'error')+'">'+text+'</div>';
    }
    function clearMessage(){document.getElementById('msg').innerHTML='';}

    async function hashPassword(password){
      const enc=new TextEncoder();
      const data=enc.encode(password);
      const hashBuffer=await crypto.subtle.digest('SHA-256',data);
      const hashArray=Array.from(new Uint8Array(hashBuffer));
      return hashArray.map(b=>b.toString(16).padStart(2,'0')).join('');
    }

    function getUsers(){
      try{return JSON.parse(localStorage.getItem('shopezz_users')||'[]');}
      catch(e){return [];}
    }

    document.getElementById('loginForm').addEventListener('submit',async function(e){
      e.preventDefault();
      clearMessage();

      const email=document.getElementById('email').value.trim().toLowerCase();
      const password=document.getElementById('password').value;

      if(!email||!password){
        return showMessage('Veuillez remplir tous les champs.');
      }

      const users=getUsers();
      const foundUser=users.find(u=>u.email===email);
      if(!foundUser){
        return showMessage('Aucun compte trouvÃ© avec cet email.');
      }

      const hash=await hashPassword(password);
      if(hash!==foundUser.passwordHash){
        return showMessage('Mot de passe incorrect.');
      }

      // SuccÃ¨s : enregistrer la "session" dans localStorage
      localStorage.setItem('shopezz_current_user', JSON.stringify({id:foundUser.id,email:foundUser.email,name:foundUser.name}));
      showMessage('Connexion rÃ©ussie ! Redirection...', 'success');

      setTimeout(()=>{window.location.href='account.html';}, 1000);
    });
  </script>
</body>
</html>
