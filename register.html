<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Shopezz ‚Äî Inscription</title>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: #f6f7fb;
      --card: #ffffff;
      --primary: #0b74ff; /* couleur principale Shopezz (√† ajuster) */
      --muted: #6b7280;
      --danger: #ef4444;
      --success: #10b981;
      --radius: 12px;
    }
    *{box-sizing:border-box;font-family: 'Poppins', sans-serif}
    body{margin:0;background:linear-gradient(180deg,var(--bg),#ffffff);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px;color:#111}
    .container{width:100%;max-width:980px;display:grid;grid-template-columns:1fr 420px;gap:28px;align-items:center}
    .hero{
      padding:36px;border-radius:var(--radius);background:linear-gradient(180deg,#fff,#f9fbff);box-shadow:0 6px 30px rgba(11,116,255,0.06);
      display:flex;flex-direction:column;gap:18px;
    }
    .hero h1{margin:0;font-size:28px}
    .hero p{margin:0;color:var(--muted)}
    .card{
      background:var(--card);border-radius:var(--radius);box-shadow:0 6px 24px rgba(15,23,42,0.06);padding:30px;
    }
    form {display:flex;flex-direction:column;gap:12px}
    label{font-size:13px;color:#333}
    input[type="text"], input[type="email"], input[type="password"]{
      padding:12px 14px;border-radius:10px;border:1px solid #e6e9ef;font-size:14px;outline:none;
    }
    input:focus{box-shadow:0 0 0 4px rgba(11,116,255,0.06);border-color:var(--primary)}
    .row {display:flex;gap:12px}
    .btn{
      background:var(--primary);color:#fff;padding:12px;border-radius:10px;border:none;font-weight:600;cursor:pointer;
    }
    .link{color:var(--primary);text-decoration:none;font-weight:600}
    .muted{color:var(--muted);font-size:13px}
    .message {padding:10px;border-radius:8px;font-size:14px}
    .error{background:rgba(239,68,68,0.08);color:var(--danger);border:1px solid rgba(239,68,68,0.12)}
    .success{background:rgba(16,185,129,0.08);color:var(--success);border:1px solid rgba(16,185,129,0.12)}
    .small{font-size:13px;color:var(--muted)}
    @media (max-width:900px){ .container{grid-template-columns:1fr;max-width:520px} }
  </style>
</head>
<body>
  <main class="container" role="main">
    <section class="hero">
      <h1>Bienvenue chez Shopezz üëã</h1>
      <p>Cr√©e ton compte pour suivre tes commandes, enregistrer tes adresses et profiter d‚Äôun checkout plus rapide.</p>

      <div class="card small">
        <strong>Pourquoi cr√©er un compte ?</strong>
        <ul>
          <li>Consulter l‚Äôhistorique de tes achats</li>
          <li>Suivre l‚Äô√©tat de tes commandes</li>
          <li>Sauvegarder plusieurs adresses</li>
        </ul>
      </div>
    </section>

    <aside class="card" aria-labelledby="register-title">
      <h2 id="register-title" style="margin-top:0">Cr√©er un compte</h2>

      <div id="msg" aria-live="polite"></div>

      <form id="registerForm" novalidate>
        <div>
          <label for="fullname">Nom complet</label>
          <input id="fullname" name="fullname" type="text" placeholder="Ex: Jean Dupont" required />
        </div>

        <div>
          <label for="email">Adresse email</label>
          <input id="email" name="email" type="email" placeholder="ex@exemple.com" required />
        </div>

        <div class="row">
          <div style="flex:1">
            <label for="password">Mot de passe</label>
            <input id="password" name="password" type="password" placeholder="8 caract√®res min." required />
            <div class="small" style="margin-top:6px">Min. 8 caract√®res ‚Äî pensez √† un mot de passe unique.</div>
          </div>

          <div style="flex:1">
            <label for="confirm">Confirmer mot de passe</label>
            <input id="confirm" name="confirm" type="password" placeholder="Retapez le mot de passe" required />
          </div>
        </div>

        <button type="submit" class="btn">Cr√©er un compte</button>

        <div style="margin-top:12px" class="muted">
          D√©j√† inscrit ? <a href="login.html" class="link">Se connecter</a>
        </div>
      </form>
    </aside>
  </main>

  <script>
    // Utilitaires
    function showMessage(text, type='error') {
      const msg = document.getElementById('msg');
      msg.innerHTML = '<div class="message ' + (type==='success' ? 'success' : 'error') + '">' + text + '</div>';
    }

    function clearMessage() {
      document.getElementById('msg').innerHTML = '';
    }

    // Hash SHA-256 via Web Crypto -> hex string
    async function hashPassword(password) {
      const enc = new TextEncoder();
      const data = enc.encode(password);
      const hashBuffer = await crypto.subtle.digest('SHA-256', data);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
      return hashHex;
    }

    // R√©cup√©rer liste d'utilisateurs depuis localStorage
    function getUsers() {
      try {
        const raw = localStorage.getItem('shopezz_users') || '[]';
        return JSON.parse(raw);
      } catch(e) {
        return [];
      }
    }

    function saveUsers(users) {
      localStorage.setItem('shopezz_users', JSON.stringify(users));
    }

    // Validation simple email
    function isValidEmail(email) {
      // regex simple mais efficace pour la plupart des cas
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    document.getElementById('registerForm').addEventListener('submit', async function(e){
      e.preventDefault();
      clearMessage();

      const fullname = document.getElementById('fullname').value.trim();
      const email = document.getElementById('email').value.trim().toLowerCase();
      const password = document.getElementById('password').value;
      const confirm = document.getElementById('confirm').value;

      // Validations c√¥t√© client
      if (fullname.length < 2) {
        return showMessage('Merci d‚Äôindiquer ton nom complet.', 'error');
      }
      if (!isValidEmail(email)) {
        return showMessage('Veuillez entrer une adresse email valide.', 'error');
      }
      if (password.length < 8) {
        return showMessage('Le mot de passe doit contenir au moins 8 caract√®res.', 'error');
      }
      if (password !== confirm) {
        return showMessage('Les mots de passe ne correspondent pas.', 'error');
      }

      // V√©rifier si l'email existe d√©j√†
      const users = getUsers();
      if (users.some(u => u.email === email)) {
        return showMessage('Un compte utilise d√©j√† cette adresse email. Essaie de te connecter.', 'error');
      }

      // Hacher le mot de passe et sauvegarder l'utilisateur
      try {
        const passwordHash = await hashPassword(password);
        const newUser = {
          id: Date.now(),
          name: fullname,
          email,
          passwordHash,
          createdAt: new Date().toISOString()
        };
        users.push(newUser);
        saveUsers(users);

        // Message de succ√®s + redirection vers login (apr√®s courte pause)
        showMessage('Compte cr√©√© avec succ√®s ! Redirection vers la page de connexion...', 'success');

        // Optionnel : enregistrer l'utilisateur courant (session simul√©e)
        localStorage.setItem('shopezz_current_user', JSON.stringify({id: newUser.id, email: newUser.email}));

        // Redirection vers login (la page login.html sera fournie ensuite)
        setTimeout(() => {
          window.location.href = 'login.html';
        }, 1200);
      } catch (err) {
        console.error(err);
        showMessage('Une erreur est survenue lors de la cr√©ation du compte.', 'error');
      }
    });
  </script>
</body>
</html>
