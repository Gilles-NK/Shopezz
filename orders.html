<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Mes commandes — Shopezz</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { font-family:'Poppins', sans-serif; background:#f9f9f9; margin:0; }
.container { max-width:900px; margin:50px auto; }
h1 { text-align:center; margin-bottom:30px; color:#111; }
.order-card { background:#fff; padding:20px; border-radius:12px; margin-bottom:20px; box-shadow:0 4px 10px rgba(0,0,0,0.05); transition: all 0.3s; }
.order-card:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(0,0,0,0.1); }
.order-card h5 { color:#007bff; }
.order-items { margin-top:10px; }
.order-items li { padding:5px 0; }
.status { font-weight:600; }
.back-btn, #clearOrdersBtn { display:block; margin:0 auto 30px auto; width:220px; text-align:center; }
#clearOrdersBtn { margin-bottom:50px; }
</style>
</head>
<body>

<div class="container">

  <a href="index.html" class="btn btn-outline-primary back-btn">
    <span class="material-icons"></span>⬅ Retour à l'accueil
  </a>

  <h1 class="mt-5">Mes commandes</h1>

  <button id="clearOrdersBtn" class="btn btn-danger">Vider l'historique des commandes</button>

  <div id="ordersList"></div>
</div>

<script>
// -------------------- Affichage commandes --------------------
function renderOrders(){
    const orders = JSON.parse(localStorage.getItem('orders')) || [];
    const ordersList = document.getElementById('ordersList');
    ordersList.innerHTML = '';
    if(orders.length === 0){
        ordersList.innerHTML = "<p>Aucune commande pour le moment.</p>";
        return;
    }
    orders.forEach(order=>{
        const itemsHtml = order.items.map(i=>`<li>${i.name} x${i.qty} - ${i.price*i.qty} FCFA</li>`).join('');
        ordersList.innerHTML += `
        <div class="order-card" data-id="${order.id}">
            <h5>Commande ${order.id}</h5>
            <p>Date: ${order.date} | Statut: <span class="status">${order.status}</span></p>
            <ul class="order-items">${itemsHtml}</ul>
            <p><strong>Total: ${order.total} FCFA</strong></p>
        </div>`;
    });
}
renderOrders();

// -------------------- Mise à jour automatique du statut --------------------
function updateOrderStatus(){
    const orders = JSON.parse(localStorage.getItem('orders')) || [];
    let changed = false;
    orders.forEach(order=>{
        if(order.status === "En traitement"){ order.status = "Expédiée"; changed = true; }
        else if(order.status === "Expédiée"){ order.status = "Livrée"; changed = true; }
    });
    if(changed){
        localStorage.setItem('orders', JSON.stringify(orders));
        renderOrders();
    }
}
setInterval(updateOrderStatus, 10000);

// -------------------- Vider l'historique des commandes --------------------
document.getElementById('clearOrdersBtn').addEventListener('click', () => {
    if(confirm("Voulez-vous vraiment supprimer toutes vos commandes ?")){
        localStorage.removeItem('orders');
        renderOrders();
    }
});
</script>

</body>
</html>
